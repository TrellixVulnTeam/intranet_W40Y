(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[371],{3491:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cvis",function(){return i(288)}])},288:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return v}});var n=i(5893),a=i(1163),r=i.n(a),s=i(7294),l=i(1664),o=i.n(l),c=i(6770),u=i.n(c),d=i(9943),h=i.n(d),f=i(765);function g(e){var t=e.authStrass,i=e.selectStrass,a=e.mounted,r=e.setMounted,l=(0,s.useState)([]),c=l[0],u=l[1];return(0,s.useEffect)((function(){a||(0,f.Z)("/cvis").then((function(e){u(e),r(!0)}))}),[a]),(0,n.jsxs)("div",{className:h().global,children:[(0,n.jsx)("h1",{children:"Catalogue C-Vis"}),t.includes(i.cn)?(0,n.jsx)(o(),{href:"/cvis?action=new",passHref:!0,children:(0,n.jsx)("h4",{className:"boutonAjout",children:"Ajouter un Article"})}):void 0,(0,n.jsx)("div",{className:h().grid,children:null===c||void 0===c?void 0:c.map((function(e,a){return(0,n.jsxs)("div",{className:h().card,children:[(0,n.jsx)("h4",{className:h().title,children:e.title}),(0,n.jsxs)("p",{className:h().prix,children:["Prix : ",e.prix]}),(0,n.jsx)("p",{className:h().quantite,children:e.quantite}),(0,n.jsx)("img",{src:"https://www.boquette.fr/api/images/"+e.img,className:h().image,alt:"logo"}),t.includes(i.cn)?(0,n.jsxs)("div",{className:h().sectionEdit,children:[(0,n.jsx)(o(),{href:"/cvis?action=modify&id="+e.id,passHref:!0,children:(0,n.jsx)("h4",{className:"boutonEdit",children:"Modifier"})}),(0,n.jsx)(o(),{href:"/cvis?action=delete&id="+e.id,passHref:!0,children:(0,n.jsx)("h4",{className:"boutonEdit",children:"Supprimer"})})]}):void 0]},a)}))})]})}function p(e){var t=e.setMounted,i=(0,s.useState)(),a=i[0],l=i[1],o=(0,s.useState)(),c=o[0],d=o[1],f=(0,s.useState)(),g=f[0],p=f[1],m=(0,s.useState)(),v=m[0],x=m[1],j=(0,s.useState)(!1),b=j[0],y=j[1];(0,s.useEffect)((function(){b&&setTimeout((function(){alert(b),y(!1)}),100)}),[b]);return(0,n.jsxs)("div",{className:h().global,children:[(0,n.jsx)("h3",{children:"Ajouter un Article"}),(0,n.jsxs)("form",{onSubmit:function(e){e.preventDefault(),new Promise((function(e){u().imageFileResizer(v,300,300,"JPEG",100,0,(function(t){e(t)}),"file")})).then((function(e){var t=new FormData;return t.append("title",a),t.append("prix",c),t.append("quantite",g),t.append("file",e),t})).then((function(e){return fetch("https://www.boquette.fr/api/cvis",{method:"POST",headers:{"x-xsrf-token":JSON.parse(localStorage.getItem("token")),"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true"},body:e,credentials:"include"})})).then((function(e){402==e.status?(localStorage.removeItem("token"),window.location.reload()):200==e.status?(r().push("/cvis"),y("Article ajout\xe9 !"),t(!1)):y("Erreur lors de l'ajout")}))},children:[(0,n.jsxs)("label",{children:[(0,n.jsx)("p",{className:"texte",children:"Description de l'article"}),(0,n.jsx)("input",{type:"text",onChange:function(e){return l(e.target.value)},className:"field",placeholder:"Bache AM trad'ss",required:!0})]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("p",{className:"texte",children:"Prix de l'article"}),(0,n.jsx)("input",{type:"text",onChange:function(e){return d(e.target.value)},className:"field",placeholder:"200\u20ac",required:!0})]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("p",{className:"texte",children:"Commentaires"}),(0,n.jsx)("input",{type:"text",onChange:function(e){return p(e.target.value)},className:"field",placeholder:"20 / M/L/XL / ..."})]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("p",{className:"texte",children:"Image de l'article"}),(0,n.jsx)("input",{type:"file",onChange:function(e){return x(e.target.files[0])},accept:"image/png, image/jpeg",className:"field",required:!0})]}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{type:"submit",className:"submit",children:"Ajouter un Article"})})]})]})}function m(e){var t=e.setMounted,i=(0,s.useState)(),a=i[0],l=i[1],o=(0,s.useState)(),c=o[0],u=o[1],d=(0,s.useState)(),g=d[0],p=d[1],m=(0,s.useState)(!1),v=m[0],x=m[1];(0,s.useEffect)((function(){r().query.id&&(0,f.Z)("/cvis/"+j).then((function(e){l(e[0].title),u(e[0].prix),p(e[0].quantite)}))}),[]),(0,s.useEffect)((function(){v&&setTimeout((function(){alert(v),x(!1)}),100)}),[v]);var j=r().query.id;return(0,n.jsxs)("div",{className:h().global,children:[(0,n.jsx)("h3",{children:"Modifier un Article"}),(0,n.jsxs)("form",{onSubmit:function(e){e.preventDefault(),(0,f.W)("/cvis","PUT",{id:j,title:a,prix:c,quantite:g}).then((function(e){200==e?(r().push("/cvis"),x("Article modifi\xe9 !"),t(!1)):x("Erreur lors de la modification")}))},children:[(0,n.jsxs)("label",{children:[(0,n.jsx)("p",{className:"texte",children:"Description de l'article"}),(0,n.jsx)("input",{type:"text",onChange:function(e){return l(e.target.value)},className:"field",placeholder:"Bache AM trad'ss",value:a,required:!0})]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("p",{className:"texte",children:"Prix de l'article"}),(0,n.jsx)("input",{type:"text",onChange:function(e){return u(e.target.value)},className:"field",placeholder:"200\u20ac",value:c,required:!0})]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("p",{className:"texte",children:"Commentaires"}),(0,n.jsx)("input",{type:"text",onChange:function(e){return p(e.target.value)},className:"field",placeholder:"20 / M/L/XL / ...",value:g})]}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{type:"submit",className:"submit",children:"Modifier un Article"})})]})]})}function v(e){var t=e.selectStrass,i=(0,s.useState)(!1),a=i[0],l=i[1],o=(0,s.useState)(!1),c=o[0],u=o[1];(0,s.useEffect)((function(){c&&setTimeout((function(){alert("Article Supprim\xe9 !"),u(!1),l(!1)}),100)}),[c]);var d=["AE","cvis"];if(!d.includes(t.cn)||!r().query.action)return(0,n.jsx)(g,{authStrass:d,selectStrass:t,mounted:a,setMounted:l});switch(r().query.action){case"new":return(0,n.jsx)(p,{setMounted:l});case"modify":if(r().query.id)return(0,n.jsx)(m,{setMounted:l});case"delete":if(r().query.id){var h=r().query.id;(0,f.W)("/cvis","DELETE",{id:h}).then((function(e){200==e&&(r().push("/cvis"),u(!0),l(!1))}))}}}},9943:function(e){e.exports={global:"Cvis_global__TF3v9",grid:"Cvis_grid__JTHHk",card:"Cvis_card__Hdys2",image:"Cvis_image__ifF92",title:"Cvis_title__UbsgT",prix:"Cvis_prix__hlslf",quantite:"Cvis_quantite__ltnXu"}},6770:function(e){(()=>{"use strict";var t={d:(e,i)=>{for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},i={};t.r(i),t.d(i,{default:()=>a});var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return t=[{key:"changeHeightWidth",value:function(e,t,i,n,a,r){return i>n&&(e=Math.round(e*n/i),i=n),e>t&&(i=Math.round(i*t/e),e=t),a&&i<a&&(e=Math.round(e*a/i),i=a),r&&e<r&&(i=Math.round(i*r/e),e=r),{height:e,width:i}}},{key:"resizeAndRotateImage",value:function(e,t,i,n,a){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"jpeg",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:100,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,o=s/100,c=document.createElement("canvas"),u=e.width,d=e.height,h=this.changeHeightWidth(d,i,u,t,n,a);!l||90!==l&&270!==l?(c.width=h.width,c.height=h.height):(c.width=h.height,c.height=h.width),u=h.width,d=h.height;var f=c.getContext("2d");return f.fillStyle="rgba(0, 0, 0, 0)",f.fillRect(0,0,u,d),f.imageSmoothingEnabled&&f.imageSmoothingQuality&&(f.imageSmoothingQuality="high"),l&&(f.rotate(l*Math.PI/180),90===l?f.translate(0,-c.width):180===l?f.translate(-c.width,-c.height):270===l?f.translate(-c.height,0):0!==l&&360!==l||f.translate(0,0)),f.drawImage(e,0,0,u,d),c.toDataURL("image/".concat(r),o)}},{key:"b64toByteArrays",value:function(e,t){t=t||"image/jpeg";for(var i=atob(e.toString().replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,"")),n=[],a=0;a<i.length;a+=512){for(var r=i.slice(a,a+512),s=new Array(r.length),l=0;l<r.length;l++)s[l]=r.charCodeAt(l);var o=new Uint8Array(s);n.push(o)}return n}},{key:"b64toBlob",value:function(e,t){var i=this.b64toByteArrays(e,t);return new Blob(i,{type:t,lastModified:new Date})}},{key:"b64toFile",value:function(e,t,i){var n=this.b64toByteArrays(e,i);return new File(n,t,{type:i,lastModified:new Date})}},{key:"createResizedImage",value:function(t,i,n,a,r,s,l){var o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"base64",c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,d=new FileReader;if(!t)throw Error("File Not Found!");if(t.type&&!t.type.includes("image"))throw Error("File Is NOT Image!");d.readAsDataURL(t),d.onload=function(){var h=new Image;h.src=d.result,h.onload=function(){var d=e.resizeAndRotateImage(h,i,n,c,u,a,r,s),f="image/".concat(a);switch(o){case"blob":var g=e.b64toBlob(d,f);l(g);break;case"base64":default:l(d);break;case"file":var p=t.name.toString().replace(/(png|jpeg|jpg|webp)$/i,"").concat(a.toString()),m=e.b64toFile(d,p,f);l(m)}}},d.onerror=function(e){throw Error(e)}}}],t&&function(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(e,t),e}();const a={imageFileResizer:function(e,t,i,a,r,s,l,o,c,u){return n.createResizedImage(e,t,i,a,r,s,l,o,c,u)}};e.exports=i})()}},function(e){e.O(0,[774,888,179],(function(){return t=3491,e(e.s=t);var t}));var t=e.O();_N_E=t}]);